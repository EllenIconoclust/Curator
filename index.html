<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MindEase - Mental Wellness App</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      font-family: 'Quicksand', sans-serif;
      box-sizing: border-box;
    }

    body {
      transition: background 1s, color 1s;
      background: linear-gradient(135deg, #e0f8e9, #ffffff);
      color: #222;
      padding: 1rem;
      line-height: 1.8;
    }

    body.dark {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #f1f1f1;
    }

    /* Login Page Styles */
    .login-container {
      max-width: 400px;
      margin: 2rem auto;
      padding: 2rem;
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .login-container h1 {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .login-input {
      width: 100%;
      padding: 0.8rem;
      margin: 0.5rem 0 1rem;
      border: 1px solid #aaa;
      border-radius: 8px;
      font-size: 1rem;
    }

    .login-btn {
      width: 100%;
      padding: 0.8rem;
      background: #7acaa3;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 1rem;
      transition: transform 0.2s;
    }

    .login-btn:hover {
      transform: scale(1.02);
    }

    /* Main App Styles */
    .app-container {
      display: none;
    }

    .toggle-wrapper {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 999;
    }

    .toggle-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #c9a935;
      border: none;
      cursor: pointer;
      position: relative;
      transition: background 0.4s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .toggle-btn.dark {
      background: #315f91;
    }

    .toggle-icon {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 0 3px rgba(0,0,0,0.2);
    }

    h1 {
      margin-bottom: 1.5rem;
      font-size: 2rem;
      text-align: center;
    }

    .section {
      margin-bottom: 3rem;
      background: rgba(255,255,255,0.1);
      padding: 1.5rem;
      border-radius: 12px;
    }

    .activity {
      background: rgba(255,255,255,0.2);
      padding: 1rem;
      border-radius: 12px;
      margin-top: 0.8rem;
      cursor: pointer;
      position: relative;
      transition: transform 0.2s;
    }

    .activity:hover {
      transform: translateY(-3px);
    }

    .activity-details {
      display: none;
      margin-top: 0.5rem;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .activity-timer {
      display: none;
      margin-top: 0.5rem;
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
    }

    .breathing-visualizer {
      width: 150px;
      height: 150px;
      margin: 1rem auto;
      border-radius: 50%;
      background: #7acaa3;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      transition: all 4s ease-in-out;
    }

    .start-activity {
      margin-top: 0.5rem;
      padding: 0.5rem 1rem;
      background: #7acaa3;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s;
    }

    .start-activity:hover {
      background: #5ab893;
    }

    .calendar {
      margin-top: 1rem;
      overflow-x: auto;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.9rem;
    }

    th, td {
      padding: 0.5rem;
      text-align: center;
      border: 1px solid #ccc;
      min-width: 30px;
    }

    td.today {
      background: #a0f3ba;
      font-weight: bold;
    }

    td.has-mood {
      position: relative;
    }

    td.has-mood::after {
      content: attr(data-mood);
      position: absolute;
      bottom: 2px;
      right: 2px;
      font-size: 0.7rem;
    }

    /* Heatmap Styles */
    .heatmap-container {
      margin-top: 2rem;
    }

    .heatmap {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 1rem;
    }

    .heatmap-day {
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .heatmap-day.empty {
      background: #f0f0f0;
    }

    .heatmap-legend {
      display: flex;
      justify-content: center;
      margin-top: 1rem;
      gap: 10px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      font-size: 0.8rem;
    }

    .legend-color {
      width: 15px;
      height: 15px;
      margin-right: 5px;
      border-radius: 3px;
    }

    /* Export Button */
    .export-btn {
      background: #315f91;
      color: white;
      margin-left: 10px;
    }

    .export-btn:hover {
      background: #254b75;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 2rem;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      animation: modalFadeIn 0.3s;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .dark .modal-content {
      background-color: #203a43;
      color: #f1f1f1;
    }

    .close-modal {
      float: right;
      cursor: pointer;
      font-size: 1.5rem;
      transition: transform 0.2s;
    }

    .close-modal:hover {
      transform: scale(1.2);
    }

    .mood-report {
      margin-top: 1rem;
    }

    .mood-chart {
      display: flex;
      height: 20px;
      margin: 1rem 0;
      border-radius: 10px;
      overflow: hidden;
    }

    .mood-chart div {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: white;
    }

    /* Responsive Design */
    @media (min-width: 768px) {
      body {
        padding: 2rem;
      }

      h1 {
        font-size: 2.5rem;
        text-align: left;
      }

      .section {
        padding: 2rem;
      }

      button.save, button.spin, button.submit-problem {
        width: auto;
      }

      th, td {
        padding: 0.8rem;
        min-width: 40px;
      }
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div class="login-container" id="login-page">
    <h1>MindEase Login</h1>
    <input type="text" id="username" class="login-input" placeholder="Your Name">
    <input type="password" id="password" class="login-input" placeholder="Password">
    <button class="login-btn" onclick="login()">Enter</button>
    <p id="login-message" style="text-align: center; margin-top: 1rem;"></p>
  </div>

  <!-- Main App -->
  <div class="app-container" id="app">
    <div class="toggle-wrapper">
      <button class="toggle-btn" onclick="toggleDarkMode()">
        <div class="toggle-icon"></div>
      </button>
    </div>

    <h1>Welcome to MindEase, <span id="user-greeting"></span>!</h1>

    <div class="section">
      <h2>üçÉ Peace Activities</h2>
      <div class="activity" onclick="toggleDetails(this)">
        Deep Breathing
        <div class="activity-details">
          Breathe in for 4 seconds, hold for 4, and breathe out for 4. Repeat 5 times.
          <div class="breathing-visualizer" id="breathing-circle">Breathe In</div>
        </div>
        <button class="start-activity" onclick="startBreathingExercise()">Start (2 mins)</button>
        <div class="activity-timer"></div>
      </div>
      
      <div class="activity" onclick="toggleDetails(this)">
        Journaling
        <div class="activity-details">Write down your thoughts without filtering them. Let your emotions flow out safely.</div>
        <button class="start-activity" onclick="startActivity(this, 300)">Start (5 mins)</button>
        <div class="activity-timer"></div>
      </div>
      
      <!-- More activities... -->
    </div>

    <div class="section">
      <h2>üìÖ Wellness Calendar</h2>
      <div class="calendar">
        <table id="calendar"></table>
      </div>
      <input type="text" id="note" placeholder="Add note for today">
      <button class="save" onclick="saveNote()">Save</button>
      <button class="save export-btn" onclick="generatePDFReport()">Export PDF</button>
      <p id="saved-note"></p>
    </div>

    <div class="section">
      <h2>üìä Mood Tracker</h2>
      <div class="mood-options">
        <span onclick="saveMood('üòä')">üòä</span>
        <span onclick="saveMood('üòê')">üòê</span>
        <span onclick="saveMood('üò¢')">üò¢</span>
        <span onclick="saveMood('üò°')">üò°</span>
      </div>
      <p id="mood-message"></p>
      
      <div class="heatmap-container">
        <h3>Monthly Mood Heatmap</h3>
        <div class="heatmap" id="mood-heatmap"></div>
        <div class="heatmap-legend">
          <div class="legend-item"><span class="legend-color" style="background:#4CAF50;"></span>Happy</div>
          <div class="legend-item"><span class="legend-color" style="background:#FFC107;"></span>Neutral</div>
          <div class="legend-item"><span class="legend-color" style="background:#2196F3;"></span>Sad</div>
          <div class="legend-item"><span class="legend-color" style="background:#F44336;"></span>Angry</div>
        </div>
      </div>
    </div>

    <!-- Other sections... -->

    <!-- Weekly Mood Report Modal -->
    <div class="modal" id="moodReportModal">
      <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <h2>Weekly Mood Report</h2>
        <div id="moodReportContent"></div>
      </div>
    </div>
  </div>

  <script>
    // User data and initialization
    let currentUser = null;
    let activityTimers = {};
    const { jsPDF } = window.jspdf;

    // Breathing exercise variables
    let breathingInterval;
    let breathingPhase = 0; // 0=inhale, 1=hold, 2=exhale
    const breathingPhases = [
      { text: "Breathe In", duration: 4000, size: "150px" },
      { text: "Hold", duration: 4000, size: "120px" },
      { text: "Breathe Out", duration: 4000, size: "100px" }
    ];

    // Login function
    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value;
      const loginMessage = document.getElementById("login-message");

      if (!username) {
        loginMessage.textContent = "Please enter your name";
        loginMessage.style.color = "red";
        return;
      }

      if (!password) {
        loginMessage.textContent = "Please enter a password";
        loginMessage.style.color = "red";
        return;
      }

      currentUser = {
        name: username,
        password: password,
        lastReportDate: localStorage.getItem("lastReportDate") || null
      };

      localStorage.setItem("currentUser", JSON.stringify(currentUser));

      document.getElementById("login-page").style.display = "none";
      document.getElementById("app").style.display = "block";
      document.getElementById("user-greeting").textContent = username;
      initializeApp();
    }

    // Initialize the app
    function initializeApp() {
      buildCalendar();
      loadSavedData();
      startFactsRotation();
      checkForWeeklyReport();
      generateHeatmap();
    }

    // Breathing exercise functions
    function startBreathingExercise() {
      const circle = document.getElementById("breathing-circle");
      const timerElement = document.querySelector("#breathing-circle").closest(".activity").querySelector(".activity-timer");
      const startButton = document.querySelector("#breathing-circle").closest(".activity").querySelector(".start-activity");
      
      // Reset if already running
      if (breathingInterval) {
        clearInterval(breathingInterval);
        breathingPhase = 0;
      }
      
      startButton.disabled = true;
      timerElement.style.display = 'block';
      timerElement.textContent = "2:00";
      
      let totalSeconds = 120;
      const countdown = setInterval(() => {
        totalSeconds--;
        const mins = Math.floor(totalSeconds / 60);
        const secs = totalSeconds % 60;
        timerElement.textContent = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        
        if (totalSeconds <= 0) {
          clearInterval(countdown);
          timerElement.textContent = "Great job!";
          startButton.disabled = false;
          setTimeout(() => timerElement.style.display = 'none', 3000);
        }
      }, 1000);
      
      startBreathingCycle(circle);
      
      // Stop after 2 minutes
      setTimeout(() => {
        clearInterval(breathingInterval);
        circle.style.width = "150px";
        circle.style.height = "150px";
        circle.textContent = "Complete!";
      }, 120000);
    }
    
    function startBreathingCycle(circle) {
      breathingInterval = setInterval(() => {
        const phase = breathingPhases[breathingPhase];
        circle.textContent = phase.text;
        circle.style.width = phase.size;
        circle.style.height = phase.size;
        
        breathingPhase = (breathingPhase + 1) % 3;
      }, 4000);
    }

    // Heatmap generation
    function generateHeatmap() {
      const heatmap = document.getElementById("mood-heatmap");
      heatmap.innerHTML = '';
      
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      const moodColors = {
        'üòä': '#4CAF50',
        'üòê': '#FFC107',
        'üò¢': '#2196F3',
        'üò°': '#F44336'
      };
      
      // Add empty cells for days before the 1st
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement("div");
        emptyDay.className = "heatmap-day empty";
        heatmap.appendChild(emptyDay);
      }
      
      // Add cells for each day of the month
      for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = new Date(year, month, day).toDateString();
        const mood = localStorage.getItem(`mood-${dateKey}`);
        const dayElement = document.createElement("div");
        dayElement.className = "heatmap-day";
        dayElement.textContent = day;
        
        if (mood && moodColors[mood]) {
          dayElement.style.background = moodColors[mood];
          dayElement.style.color = "white";
        }
        
        if (day === today.getDate()) {
          dayElement.style.border = "2px solid #000";
        }
        
        heatmap.appendChild(dayElement);
      }
    }

    // PDF Report Generation
    function generatePDFReport() {
      const doc = new jsPDF();
      const username = currentUser.name;
      const today = new Date();
      
      // Title
      doc.setFontSize(22);
      doc.setTextColor(40, 180, 99);
      doc.text(`MindEase Wellness Report`, 105, 20, null, null, 'center');
      
      // User info
      doc.setFontSize(14);
      doc.setTextColor(0, 0, 0);
      doc.text(`Generated for: ${username}`, 15, 35);
      doc.text(`Date: ${today.toDateString()}`, 15, 45);
      
      // Mood data
      doc.setFontSize(18);
      doc.setTextColor(40, 180, 99);
      doc.text(`Mood Summary`, 15, 60);
      
      // Get mood data for the past 30 days
      const moodCounts = { 'üòä': 0, 'üòê': 0, 'üò¢': 0, 'üò°': 0 };
      const moodEntries = [];
      
      for (let i = 29; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateKey = date.toDateString();
        const mood = localStorage.getItem(`mood-${dateKey}`);
        
        if (mood) {
          moodCounts[mood]++;
          moodEntries.push({
            date: date.toLocaleDateString(),
            mood: mood
          });
        }
      }
      
      // Mood chart
      doc.setFontSize(12);
      doc.setTextColor(0, 0, 0);
      doc.text(`Mood Distribution (Last 30 Days)`, 15, 75);
      
      // Simple bar chart
      const colors = {
        'üòä': [76, 175, 80],
        'üòê': [255, 193, 7],
        'üò¢': [33, 150, 243],
        'üò°': [244, 67, 54]
      };
      
      let yPos = 85;
      Object.entries(moodCounts).forEach(([mood, count]) => {
        if (count > 0) {
          doc.setFillColor(...colors[mood]);
          doc.rect(15, yPos, count * 5, 8, 'F');
          doc.text(`${mood}: ${count} days`, 20 + count * 5, yPos + 6);
          yPos += 12;
        }
      });
      
      // Mood log
      doc.addPage();
      doc.setFontSize(18);
      doc.setTextColor(40, 180, 99);
      doc.text(`Daily Mood Log`, 15, 20);
      
      doc.setFontSize(10);
      let logY = 30;
      moodEntries.forEach(entry => {
        if (logY > 250) {
          doc.addPage();
          logY = 20;
        }
        doc.text(`${entry.date}: ${entry.mood}`, 15, logY);
        logY += 10;
      });
      
      // Save the PDF
      doc.save(`MindEase_Report_${username}_${today.toISOString().split('T')[0]}.pdf`);
    }

    // Rest of your existing functions...
    // (toggleDarkMode, toggleDetails, buildCalendar, saveNote, saveMood, etc.)

    // Initialize on load
    window.onload = function() {
      const savedUser = localStorage.getItem("currentUser");
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        document.getElementById("login-page").style.display = "none";
        document.getElementById("app").style.display = "block";
        document.getElementById("user-greeting").textContent = currentUser.name;
        initializeApp();
      }
    };
  </script>
</body>
</html>
